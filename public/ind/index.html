
<html>
<head lang="en">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/bootstrap-select.min.css"/>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <link rel="stylesheet" href="css/main.css"/>

    <title>Indicadores De Choucair</title>
</head>
<body data-ano="2015" data-mes="1" data-url="IndicesClientes" data-analista="1">

    <div class="container main-content">
        <div class="jumbotron">
            <img class="img-rounded" id="img" src="../../common/img/logochoucair.png" alt="" width="262" height="66">
        </div>
       <div align="right">
           <a href="/signout">
            <div class="btn btn-warning signout">Sign Out</div>
        </a>
       </div>
        <!-- Navigation -->
        <nav class="navbar navbar-default">
            <div class="container">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header page-scroll">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav navbar-middle" title="Menu">
                        <li class="page-scrol"  style="margin: 1em;">
                            <label for="servicioselect">Servicio</label><br/>
                            <select  class="selectpicker span2" title='Seleccione El Servicio'
                                     id="ServicioSelect">
                                <option label="Dashboard" value="Dashboard">Reporte General</option>
                                <option label="IndicesAnalista" value="IndicesAnalista">Panorama Por Analista</option>
                                <option label="IndicesClientes" value="IndicesClientes">Panorama Por Cliente</option>
                                <option label="HorasPorAnalista" value="HorasPorAnalista">Acompa침amiento Diario</option>
                                <option label="HorasPorCargoPorCiudad" value="HorasCargoCiudad">Horas Por Servicio/Cargo</option>
                                <option label="FaltaTarifames" value="FaltaTarifaMes">Reporte De Tarifas </option>
                                <option label="ReporteMaxTime" value="ReporteMaxTime">Reporte De MaxTime </option>
                                <option label="ReporteUltimaFecha" value="ReporteUltimaFecha">Reporte Ultima Fecha </option>
                            </select>
                        </li>
                        <li class="page-scroll" id="anoLI" style="margin: 1em;">
                            <label for="anoSelect">A침o</label><br/>
                            <select class="selectpicker span2"
                                    title='Seleccione El A침o' id="anoSelect">
                                <option value="2015">2015</option>
                                <option value="2014">2014</option>
                                <option value="2013">2013</option>
                                <option value="2012">2012</option>
                            </select>
                        </li>
                        <li class="page-scroll"  id="mesLI" style="margin: 1em;">
                            <label for="mesSelect">Mes</label><br/>
                            <select class="selectpicker span2"  title='Seleccione El Mes'
                                    id="mesSelect">
                                <option value="1">Enero</option>
                                <option value="2">Febrero</option>
                                <option value="3">Marzo</option>
                                <option value="4">Abril</option>
                                <option value="5">Mayo</option>
                                <option value="6">Junio</option>
                                <option value="7">Julio</option>
                                <option value="8">Agosto</option>
                                <option value="9">Septiembre</option>
                                <option value="10">Octube</option>
                                <option value="11">Noviembre</option>
                                <option value="12">Diciembre</option>
                            </select>
                        </li>
                        <li class="page-scroll" style="margin: 1em;display:none;" id="analistaLI">
                            <label for="AnalistaSelect">Analista</label><br/>
                            <select name="AnalistaSelect" data-live-search="true" title='Seleccione El Analista'  data-width="330px"
                                    class="selectpicker span4" id="AnalistaSelect" >
                            </select>
                        </li>
                    </ul>
                </div>
                <!-- /.navbar-collapse -->
            </div>
            <!-- /.container-fluid -->
        </nav>
       <div align="left">
           <button type="button" id="btnModal" class="btn btn-primary btn-sm exportar"style="float:right;">
               <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
           </button>
       </div>

        <H3>FILTROS</H3>
        <div class="panel panel-primary">
            <div class="panel-body">
                <div id="dashboard_div" style="height: 20px; align-content: center"></div>
            </div>
        </div>
        <!--<div id="buttonCharts" align="center">-->
            <!--<input type="button" class="btn btn-default exportar" id="draw-chartClientes" value="Clientes" />-->
            <!--<input type="button" class="btn btn-default exportar" id="draw-chartServicios" value="Servicio" />-->
            <!--<input type="button" class="btn btn-default exportar" id="draw-chartCargo" value="Cargo" />-->
            <!--<input type="button" class="btn btn-default exportar" id="draw-chartAnalista" value="Analista" />-->
        <!--</div>-->
        <div id="myModal" class="modal fade">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">Decripci칩n de Campos</h4>
                    </div>
                    <div class="col-md-4">
                        <b style="font-size: medium">IE</b>
                        <b>=</b>
                        Horas Facturables / Horas Laborales
                    </div>
                    <div class="col-md-4">
                        <b style="font-size: medium">IOP</b>
                        <b>=</b>
                        (Horas Facturables - Horas Adicionales) /Horas Laborales
                    </div>
                    <div class="col-md-4">
                        <b style="font-size: medium">IF</b>
                        <b>=</b>
                        Horas Facturables / (Horas Laborales - (Incapacidades+Vacaciones))
                    </div>
                    <div class="col-md-4">
                        <b style="font-size: medium">Incap</b>
                        <b>=</b>
                        Incapacidades
                    </div>
                    <div class="col-md-4">
                        <b style="font-size: medium">Vac</b>
                        <b>=</b>
                        Vacaciones
                    </div>
                    <div class="col-md-4">
                        <b style="font-size: medium">Comp</b>
                        <b>=</b>
                        Compesantorias
                    </div>
                    <div class="col-md-4">
                        <b style="font-size: medium">HANF</b>
                        <b>=</b>
                        Horas Adicionales No Facturables
                    </div>
                    <div class="col-md-4">
                        <b style="font-size: medium">HAF</b>
                        <b>=</b>
                        Horas Adicionales Facturables
                    </div>
                    <div class="col-md-4">
                        <b style="font-size: medium">HASC</b>
                        <b>=</b>
                        Horas Adicionales Solicitadas por el Cliente
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="buttonDiv" align="right">
            <input type="button" class="btn btn-default exportar" id="btnExport" value="Exportar a Excel" style="display:none;" />
        </div>
        <div id="charts">
           <div align="middle"><img src="assets/img/preloader.gif" alt=""/></div>
        </div>
    </div>


    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="lib/all.min.js"></script>

<script type="text/javascript">
    function searchToObject(urlSearch) {
        var pairs = urlSearch.substring(1).split("&"),
        obj = {},
        pair,
        i;
        for ( i in pairs ) {
            if ( pairs[i] === "" ) continue;

            pair = pairs[i].split("=");
            obj[ decodeURIComponent( pair[0] ) ] = decodeURIComponent( pair[1] );
        }

        return obj;
    }
    // Load the Visualization API and the charts package.
    google.load('visualization', '1.1', {'packages':['corechart','controls','table', 'calendar']});
    // Set a callback to run when the Google Visualization API is loaded.
    google.setOnLoadCallback(drawChart);

    /**
     *
     * @param <String> classText
     * @param <String>idText
     */
    function addDivCharts(classText, idText, erase) {
        var list = document.getElementById('charts');
        list.innerHTML = (erase ? "" : list.innerHTML) + '<div class=' + classText  + '> <div id=' + idText + '></div></div>';
    }

    function addDivDelayCharts(classText, idText) {
        var list = document.getElementById('charts');
        list.innerHTML = list.innerHTML + '<div class=' + classText  + '> <div id=' + idText + ' style="display:none;" ></div></div>';
    }

    function addDynamicFilters(idText) {
        var list = document.getElementById('dashboard_div');
        list.innerHTML = list.innerHTML + '<div id=' + idText  + ' style="float:left; padding-left: 30px;"' + '> </div>';
    }


    var now = new Date();

    $("#mesSelect").on("change", function(e){
        $.data(document.body, "mes", this.value);
        onChange();
    });

    $("#anoSelect").on("change", function(e){
        $.data(document.body, "ano", this.value);
        onChange();
    });

    $("#ServicioSelect").on("change", function(e){
        $.data(document.body, "url", this.value);
        onChange();
    });

    $("#AnalistaSelect").on("change", function(e){
        $.data(document.body, "analista", this.value);
        onChange();
    });

    $('#btnExport').click(function(){
        var data = {
            ano: $.data(document.body, "ano"),
            mes: $.data(document.body, "mes")
        };
        var urls = $.data(document.body, "url");
        if(urls == 'ReporteMaxTime'){
            window.open(config.apiEndpoint + 'reporteMaxTime?'+$.param(data));
        }
        else {
            window.open(config.apiEndpoint + 'reporteUltimaFecha?' + $.param(data));
        }
    });

    function onChange(){
        // actualizar el ano y mes
        var data = {
            ano: $.data(document.body, "ano"),
            mes: $.data(document.body, "mes"),
            url: $.data(document.body, "url"),
            analista:$.data(document.body, "analista")
        };
        window.location.hash = "#?"+$.param(data);
        window.location.reload();
    }

    /**
     *
     * @param rows
     * @param chart
     * @param heightPerRow
     */
    function setOptionsCharts(rows, chart, heightPerRow){
        var numberRows = rows.getNumberOfRows();
        chart.setOption('height',numberRows*heightPerRow + 120);
        chart.setOption('chartArea.height', numberRows*heightPerRow);
        chart.setOption('fontSize',12);
    }


    //fill the dynamically the analysts <select>
    $.getJSON(config.apiEndpoint + 'IdNombreAnalista', function(data){
//        $('#AnalistaSelect').append('<option value="' + '0' + '">' + "Selecctione Uno" + '</option>');
        $.each(data, function(key, val){
            $('#AnalistaSelect').append('<option value="' + val.Id + '">' + val.Nombre + '</option>');
        })
    });

    function convertToDate(data){
        var dateIndexes = [];
        data['cols'].forEach(function(col, i){
            var index = 0;
            if (col.type === 'date') index = 1;
            dateIndexes.push(index);
        });
        data['rows'].forEach(function(row, indexRow){
            row['c'].forEach(function(value, indexValue){
                if (dateIndexes[indexValue] === 1){
                    var dateSlices = value['v'].substr(0,10).split("-");
                    data['rows'][indexRow]['c'][indexValue]['v'] =
                    new Date(parseInt(dateSlices[0]),
                        parseInt(dateSlices[1])-1,
                        parseInt(dateSlices[2]));
                }
            });
        });
        return data;
    }

    function drawChart(e, ano, mes, url, analista) {
        var ano = ano || now.getFullYear();
        var mes = mes || now.getMonth()+1;
        var urls = url || "IndicesClientes";
        var analista = analista || 0;
        var jsonData = $.ajax({
            url: config.apiEndpoint + urls,
            dataType:"json",
            data: {"ano": ano, "mes": mes, "analista": analista, "url": urls}
        }).then(function(data, textStatus){
            if(url){
                changeService(urls);
                draw(convertToDate(data));
            }

        }, function(xhr, textStatus){
            console.log("ERROR 123");
        });
    }

    $(document).ready(function(){
        var searchObj = searchToObject(window.location.hash.substring(1)),
                servicio = searchObj.url || "IndicesClientes",
                ano = searchObj.ano || now.getFullYear(),
                mes = searchObj.mes || (now.getMonth()+1);
        changeService(servicio);
        $("#mesSelect").val(mes);
        $.data(document.body, "mes", mes);
        $("#anoSelect").val(ano);
        $.data(document.body, "ano", ano);
        $("#ServicioSelect").val(servicio);
        $.data(document.body, "url", servicio);
        $("#AnalistaSelect").val(searchObj.analista);
        $.data(document.body, "analista", searchObj.analista);
        drawChart(null, ano, mes, servicio, parseInt(searchObj.analista));


        $("#btnModal").click(function(){
            $("#myModal").modal('show');
        });

        setTimeout(function(){
            $("#chart5_div").fadeIn(2000);
            $("#chart6_div").fadeIn(2000);
            $("#chart7_div").fadeIn(2000);
            $("#chart8_div").fadeIn(2000);
        }, 10000 );

        setTimeout(function(){
            $("#chart9_div").fadeIn(2000);
            $("#chart10_div").fadeIn(2000);
            $("#chart11_div").fadeIn(2000);
            $("#chart12_div").fadeIn(2000);

        }, 15000 );

        setTimeout(function(){
            $("#chart17_div").fadeIn(2000);
            $("#chart18_div").fadeIn(2000);
            $("#chart19_div").fadeIn(2000);
            $("#chart20_div").fadeIn(2000)
        }, 25000 );

    });

    function changeService(service){
        document.getElementById("serviceScript")
        .setAttribute("src","./assets/js/"+service+".js")
    }

    function comboCharts(chartType,containerId, title,vAxisTitle, hAxisTitle,format,height, orientation, colors){
        return chart = new google.visualization.ChartWrapper({
            'chartType': chartType,
            'containerId': containerId,
            'options': {
                title: title,
                vAxis: {title: vAxisTitle, minValue: 0, format: format},
                hAxis: {title: hAxisTitle, minValue: 0, format: format},
                height: height,
                colors: colors,
                orientation: orientation,
                seriesType: "bars",
                displayAnnotations: true
            }
        });
    }
    function setViewIngresos(chart){
        chart.setView({
            columns: ([0,
                1,
                { calc: "stringify",
                    sourceColumn: 1,
                    type: "string",
                    role: "annotation" },
                2,
                { calc: "stringify",
                    sourceColumn: 2,
                    type: "string",
                    role: "annotation" }
            ])
        });
    }

    function setViewSumHoras(chart){
        chart.setView({
            columns: ([0,
                1,
                { calc: "stringify",
                    sourceColumn: 1,
                    type: "string",
                    role: "annotation" },
                2,
                { calc: "stringify",
                    sourceColumn: 2,
                    type: "string",
                    role: "annotation" },
                3,
                { calc: "stringify",
                    sourceColumn: 3,
                    type: "string",
                    role: "annotation" },
                4,
                { calc: "stringify",
                    sourceColumn: 4,
                    type: "string",
                    role: "annotation" },
                5,
                { calc: "stringify",
                    sourceColumn: 5,
                    type: "string",
                    role: "annotation" },
                6,
                { calc: "stringify",
                    sourceColumn: 6,
                    type: "string",
                    role: "annotation" }
            ])
        });
    }
    function setViewSumDesperdicioHoras(chart){
        chart.setView({
            columns: ([0,
                1,
                { calc: "stringify",
                    sourceColumn: 1,
                    type: "string",
                    role: "annotation" },
                2,
                { calc: "stringify",
                    sourceColumn: 2,
                    type: "string",
                    role: "annotation" },
                3,
                { calc: "stringify",
                    sourceColumn: 3,
                    type: "string",
                    role: "annotation" },
                4,
                { calc: "stringify",
                    sourceColumn: 4,
                    type: "string",
                    role: "annotation" },
                5,
                { calc: "stringify",
                    sourceColumn: 5,
                    type: "string",
                    role: "annotation" },
                6,
                { calc: "stringify",
                    sourceColumn: 6,
                    type: "string",
                    role: "annotation" },
                7,
                { calc: "stringify",
                    sourceColumn: 7,
                    type: "string",
                    role: "annotation" },
                8,
                { calc: "stringify",
                    sourceColumn: 8,
                    type: "string",
                    role: "annotation" }
            ])
        });
    }

</script>
<script id="serviceScript"></script>

    <div id="wrapperFooter" style="display:none;">
        <div id="footer">
            <h1><p>Agrupador de Actividades</p></h1>
            <div class="footerFloat">
                <h5><b>Compensatorios</b></h5>
                <ul>
                    <li>Compensatorio</li>
                    <li>Permisos</li>
                </ul>
            </div>
            <div class="footerFloat">
                <h5><b>Vacaciones</b></h5>
                <ul>
                    <li>Vacaciones</li>
                    <li>Licencia Remunerada</li>
                    <li>Licencia No Remunerada</li>
                </ul>
            </div>
            <div class="footerFloat">
                <h5><b>Informaci칩n</b></h5>
                <ul>
                    <li>Administrativas</li>
                    <li>Formaci칩n</li>
                    <li>Reuniones</li>
                    <li>Infraestructura Tecnol칩gica</li>
                </ul>
            </div>
            <div class="footerFloat">
                <h5><b>Incapacidades</b></h5>
                <ul>
                    <li>Calamidad Dom칠stica</li>
                    <li>Incapacidad</li>
                    <li>Licencia Maternidad</li>
                    <li>Licencia Paternidad</li>
                    <li>Per칤odo Lactancia</li>
                </ul>
            </div>
            <hr/>
            <div class="footerFloat">
                <h5><b>Preventas</b></h5>
                <ul>
                    <li>Prospectos</li>
                    <li>Preventa</li>
                </ul>
            </div>
            <div class="footerFloat">
                <h5><b>Errores</b></h5>
                <ul>
                    <li>Desperdicio</li>
                    <li>Repetici칩n de Pruebas</li>
                </ul>
            </div>
            <div class="footerFloat">
                <h5><b>Inducci칩n</b></h5>
                <ul>
                    <li>Inducci칩n</li>
                </ul>
            </div>
            <div class="footerFloat">
                <h5><b>Proyecto Choucair</b></h5>
                <ul>
                    <li>Proyecto Choucair</li>
                    <p>&nbsp;</p>
                </ul>
            </div>
            <br/>
            <div class="footerFloat">
                <h5><b>(HANF)</b></h5>
                <ul>
                    <li>Hora Adicional No Facturable </li>
                </ul>
            </div>
            <div class="footerFloat">
                <h5><b>(HAF)</b></h5>
                <ul>
                    <li>Hora Adicional Facturable </li>
                </ul>
            </div>
            <div class="footerFloat">
                <h5><b>(HASC)</b></h5>
                <ul>
                    <li>Hora Adicional Solicitada Por El Cliente</li>
                </ul>
            </div>
        </div>
    </div>


</body>
</html>